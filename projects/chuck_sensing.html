<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Drill Rig Chuck Direction, Rotation, and Movement Sensing | Dr. Utkarsh Jadli</title>

  <style>
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      max-width: 980px;
      margin: 40px auto;
      padding: 0 18px;
      line-height: 1.65;
      color:#111;
      background:#fff;
    }
    h1{
      font-size: 40px;
      margin: 0 0 6px;
      font-weight: 800;
    }
    .subtitle{
      font-size: 16px;
      color:#444;
      margin:0 0 18px;
      font-weight: 500;
    }
    .topnav{
      margin: 10px 0 24px;
      font-size: 16px;
    }
    .topnav a{
      color:#0b66c3;
      text-decoration:none;
      font-weight:600;
    }
    .topnav a:hover{ text-decoration: underline; }

    h2{
      margin-top: 34px;
      border-bottom:2px solid #eee;
      padding-bottom:10px;
      font-size: 28px;
      font-weight: 800;
    }

    .project{
      padding: 16px 18px;
      border: 1px solid #eee;
      border-radius: 12px;
      background: #fafafa;
      margin-bottom: 18px;
    }

    /* Project title: bigger, red, bold */
    .project-title{
      font-size: 34px;
      font-weight: 800;
      color: #c00000;
      margin: 12px 0 12px;
    }

    /* Question blocks */
    .q-title{
      font-size: 18px;
      font-weight: 800;
      color: #0b66c3;
      margin: 0;
    }
    .qbox{
      background:#fff;
      border:1px solid #e8e8e8;
      border-radius:12px;
      padding:14px 16px;
      margin:14px 0;
    }
    .q-sep{
      height:1px;
      background:#eeeeee;
      margin:10px 0 12px;
    }

    .kpi{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }
    .kpi span{
      display:inline-block;
      border:1px solid #e6e6e6;
      background:#fff;
      border-radius:999px;
      padding:6px 10px;
      font-size:13px;
    }

    .figure{
      margin:12px 0 0;
      padding:10px;
      background:#fff;
      border:1px solid #eee;
      border-radius:12px;
    }
    .figure img{
      width:100%;
      height:auto;
      border-radius:10px;
      display:block;
    }
    .caption{
      font-size:13px;
      color:#555;
      margin-top:8px;
    }

    .muted{ color:#555; }

    /* Lists inside qboxes */
    .qbox ul{ margin: 8px 0 0 20px; }
    .qbox li{ margin: 8px 0; }

    .subheading-list{
      margin: 12px 0 8px 22px;
      padding: 0;
    }
    .subheading-list li{
      font-weight: 400;
      color: #222;
      margin: 10px 0 10px;
    }
    .subheading-list li i,
    .subheading-list li b{
      font-weight: 700;
      font-style: normal;
    }

    .hr{ height:1px; background:#eee; margin:18px 0; }

    code{ background:#f3f3f3; padding:2px 6px; border-radius:6px; }
  </style>
</head>

<body>

  <div class="topnav">
    ← <a href="../index.html">Back to Home</a>
  </div>

  <div class="project">
    <div class="project-title">Drill Rig Chuck Direction, Rotation, and Movement Sensing</div>
    <p><b>Role:</b> Electronics Design + Firmware + Validation Testing</p>

    <!-- ===================== -->
    <!-- Why / Goal / Constraints -->
    <!-- ===================== -->
    <div class="qbox">
      <div class="q-title">Why does this project matter?</div>
      <div class="q-sep"></div>

    <p>
        Drill rigs rely on correct chuck rotation and controlled feed to avoid equipment damage and protect the
        operator—especially during rod make-up and break-out. If the chuck rotates in the wrong direction, it can jam,
        cross-thread, or snap the drill rod, potentially damaging the rig and creating a safety hazard for the crew.
    </p>
    
    <p>
      At the same time, operators often track drilling progress using a manual logsheet (rod count and depth). This is
      time-consuming and error-prone. By sensing chuck rotation speed (RPM), rotation direction (CW/CCW), and linear
      feed/stroke, the system enables:
    </p>
  
    <ul>
      <li>safer verification of correct make/break rotation behaviour,</li>
      <li>improved operational control (RPM selection for changing rock structures and directional drilling),</li>
      <li>automated estimation of rod count and drilling depth from measured stroke.</li>
    </ul>
    
      <p>
        This makes the sensing module valuable for both safety-critical operation and productivity/automation on the rig.
      </p>
    </div>

    <div class="qbox">
      <div class="q-title">What was the goal?</div>
      <div class="q-sep"></div>
    
      <p>
        The goal was to develop an intrinsically safe, field-deployable sensing system capable of reliably measuring
        drill rig chuck rotation direction, rotation speed (RPM), and linear feed/stroke movement in real time.
      </p>
    
      <p>
        The system was intended to improve drilling safety during rod make/break operations and enable automated estimation
        of rod count and drilling depth, with sensor data designed for transmission over an RS485 industrial communication interface.
      </p>
    </div>

    <div class="qbox">
      <div class="q-title">What constraints mattered most?</div>
      <div class="q-sep"></div>
    
      <ul>
        <li>
          <b>Harsh drill rig conditions:</b> the system needed to remain reliable under vibration, dust, mechanical shock,
          and industrial contamination.
        </li>
    
        <li>
          <b>Wide operating speed range:</b> chuck rotation had to be detected accurately across typical drilling speeds of
          10–700 RPM, including start/stop and reversal events.
        </li>
    
        <li>
          <b>Reliable direction detection:</b> incorrect direction reporting during rod make/break could lead to rod damage
          and safety risks.
        </li>
    
        <li>
          <b>High-resolution linear feed sensing:</b> stroke measurement needed sufficient sampling rate and stability to
          enable rod counting and depth estimation.
        </li>
    
        <li>
          <b>Intrinsic Safety compliance (IS):</b> the sensing electronics had to operate under strict energy-limiting
          constraints suitable for hazardous environments.
        </li>
    
        <li>
          <b>Robust industrial communication:</b> telemetry had to be suitable for long cable runs and noisy environments,
          leading to an RS485-based architecture (Modbus-ready).
        </li>
      </ul>
    </div>

    <div class="qbox">
      <div class="q-title">What did I design?</div>
      <div class="q-sep"></div>
    
      <p>
        An end-to-end drill rig chuck sensing module capable of measuring <b>rotation speed (RPM)</b>, 
        <b>rotation direction (CW/CCW)</b>, and <b>linear feed/stroke travel</b>. The system combined a Hall-effect 
        dual-latch rotation sensor with a ToF-based stroke sensor, integrated into an intrinsically safe 
        STM32-based electronics platform with RS485 (Modbus-ready) communication for industrial deployment.
      </p>
    
      <div class="kpi">
        <span><b>Rotation sensing:</b> Hall-effect dual latch</span>
        <span><b>Direction:</b> CW / CCW detection</span>
        <span><b>Speed range:</b> 10–700 RPM</span>
        <span><b>Stroke sensing:</b> LIDAR module</span>
        <span><b>Stroke sampling:</b> 50 samples/sec</span>
        <span><b>MCU:</b> STM32 </span>
        <span><b>Comms:</b> RS485 (Modbus RTU ready)</span>
        <span><b>Design:</b> Intrinsically Safe architecture</span>
      </div>
    </div>

    <div class="qbox">
      <div class="q-title">How did the chuck rotation speed and direction sensing work?</div>
      <div class="q-sep"></div>
    
      <ul class="subheading-list">
    
        <li>
          <b>Preliminary Thinking</b><br>
          Initially, the design approach considered using two Hall-effect switches to detect chuck rotation. 
          If two sensors proved insufficient for reliable direction sensing, the fallback plan was to implement 
          a four-sensor quadrature-style arrangement for robust CW/CCW detection.
          <br><br>
          For rapid prototyping, a commercial Hall-effect sensor module (XC-4434) was purchased and interfaced 
          with an Arduino MKR Zero. Early testing confirmed that rotation speed measurement was straightforward: 
          using a single magnet mounted on the rotating target, RPM could be computed accurately by measuring the 
          pulse period. The setup was later validated on a lathe machine, successfully detecting chuck speeds across 
          a wide range of approximately <b>35 RPM to 2000 RPM</b>. 
          However, determining rotation direction proved more challenging. A configuration using two sensor modules 
          and one magnet was tested, but it did not produce a consistent or repeatable phase relationship. As a result, 
          there was no reliable signature to detect reversal, making direction classification unstable.
          <br><br>
          To address this, a dedicated low-voltage dual Hall-effect latch sensor was selected, capable of supporting 
          both speed and direction detection. The device integrates an internal voltage regulator, two Hall sensing 
          elements with offset cancellation, and dual open-drain output drivers in a single package—providing a compact 
          and robust solution suitable for industrial field deployment.
        </li>
    

        <li>
          <b>Challenges in direction detection using a Hall-effect dual latch sensor</b><br>
        
          Rotation speed measurement using the dual Hall-effect dual latch sensor was relatively straightforward and similar to
          the earlier XC-4434 module. RPM could be calculated reliably by measuring the pulse period generated on the open-drain
          <b>SP (speed)</b> output.<br><br>
        
          However, rotation direction detection was significantly more complex, as outlined in the sensor datasheet. The device
          determines direction based on a specific magnetic field sequence generated by a magnetic encoder disk with alternating
          <b>North–South poles</b>. This alternating pole arrangement produces a defined switching pattern that allows the sensor to
          drive the open-drain <b>DIR</b> output high or low depending on rotation direction.<br><br>
        
          In the drill rig application, the chuck rotation assembly used a large-diameter disk (Figure 1) designed to house
          discrete magnets. Replicating the datasheet-recommended alternating N–S magnetic ring on this disk would require
          approximately <b>50 magnets</b> to form a full alternating pole pattern (Figure 2).<br><br>
        
          <div class="figure">
            <img src="../assets/Magnet_Housing_Disk.png" alt=" Chuck magnet housing disk (large diameter)">
            <div class="caption">Figure 1: Chuck rotation magnet housing disk used for experiments.</div>
          </div>
        
          <div class="figure">
            <img src="../assets/Altenating_N_S_pole.png" alt=" Alternating N-S pole arrangement required for direction detection">
            <div class="caption">Figure 2: Datasheet-style alternating N–S pole arrangement required for DIR output sequencing.</div>
          </div>
        
          This approach was not considered viable due to:
          <ul>
            <li>high component count and assembly complexity,</li>
            <li>increased mechanical integration effort,</li>
            <li>poor cost-effectiveness for field deployment.</li>
          </ul>
        
          Additionally, experimental testing on the lathe revealed that the DIR output behaviour was highly sensitive to
          sensor-to-magnet spacing and alignment, making it difficult to obtain a stable and repeatable direction signal using a
          conventional arrangement.<br><br>
        
          As a result, an alternative solution was required. The key insight was that if the magnet offset and air-gap distance
          could be optimized, the sensor could be driven into producing a consistent switching sequence—allowing reliable
          direction detection without requiring a full alternating-pole magnetic ring.
        </li>
        
        <li>
          <b>Alternate solution for direction detection</b><br>
        
          To overcome the limitations of requiring a full alternating N–S magnetic ring, an alternative magnet arrangement
          was developed on the chuck magnet housing disk, as shown in Figure 3. The goal was to generate a repeatable
          switching sequence that changes predictably when the chuck rotation reverses direction.<br><br>
        
          Through multiple trial-and-error experiments on the lathe machine, a critical sensor placement window was
          identified. A sensor-to-magnet offset of approximately <b>22–24 mm (Y)</b> and <b>1–3 mm (X)</b> (Figure 4)
          consistently produced the required switching behaviour on the DIR output.
        
          <div class="figure">
            <img src="../assets/Block_diagram.png" alt=" Proposed alternate magnet arrangement on chuck disk">
            <div class="caption">Figure 3: Proposed alternate magnet arrangement on the chuck magnet housing disk.</div>
          </div>
        
          <div class="figure">
            <img src="../assets/x_y_pos.png" alt=" Sensor offset distance X and Y used for direction detection">
            <div class="caption">Figure 4: Sensor placement window (X and Y offset) identified through lathe testing.</div>
          </div>
          <br><br>

          Using this optimized geometry, distinct pulse patterns were observed for clockwise and anticlockwise rotation.
          The measured sequences are summarized in <b>Table 1</b> and illustrated in <b>Figure 5</b>.
          
          <div class="figure">
            <div class="caption"><b>Table 1:</b> Specific sequence for direction detection</div>
          
            <table style="width:100%; border-collapse:collapse; margin-top:10px; font-size:15px;">
              <thead>
                <tr style="border-top:2px solid #111; border-bottom:2px solid #111;">
                  <th style="text-align:left; padding:8px;">Direction</th>
                  <th style="text-align:center; padding:8px;">Step</th>
                  <th style="text-align:center; padding:8px;">H1</th>
                  <th style="text-align:center; padding:8px;">Output State</th>
                  <th style="text-align:center; padding:8px;">H2</th>
                  <th style="text-align:center; padding:8px;">Output State</th>
                </tr>
              </thead>
          
              <tbody>
                <!-- Anticlockwise -->
                <tr>
                  <td rowspan="6" style="text-align:left; padding:8px; font-weight:600;">Anticlockwise</td>
                  <td style="text-align:center; padding:8px;"><i>St(t)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                </tr>
          
                <tr>
                  <td style="text-align:center; padding:8px;"><i>St(t+1)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                </tr>
          
                <tr>
                  <td style="text-align:center; padding:8px;"><i>St(t+2)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                </tr>
          
                <tr>
                  <td style="text-align:center; padding:8px;"><i>St(t+3)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                </tr>
          
                <tr>
                  <td style="text-align:center; padding:8px;"><i>St(t+4)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                </tr>
          
                <tr style="border-bottom:2px solid #111;">
                  <td style="text-align:center; padding:8px;"><i>St(t+5)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                </tr>
          
                <!-- Clockwise -->
                <tr>
                  <td rowspan="6" style="text-align:left; padding:8px; font-weight:600;">Clockwise</td>
                  <td style="text-align:center; padding:8px;"><i>St(t)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                </tr>
          
                <tr>
                  <td style="text-align:center; padding:8px;"><i>St(t+1)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                </tr>
          
                <tr>
                  <td style="text-align:center; padding:8px;"><i>St(t+2)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                </tr>
          
                <tr>
                  <td style="text-align:center; padding:8px;"><i>St(t+3)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">S</td>
                  <td style="text-align:center; padding:8px;">0</td>
                </tr>
          
                <tr>
                  <td style="text-align:center; padding:8px;"><i>St(t+4)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                </tr>
          
                <tr style="border-bottom:2px solid #111;">
                  <td style="text-align:center; padding:8px;"><i>St(t+5)</i></td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                  <td style="text-align:center; padding:8px; color:#c00000; font-weight:700;">N</td>
                  <td style="text-align:center; padding:8px;">1</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="figure">
            <img src="../assets/Direction_working_principle.png" alt=" Pulse sequence and duty cycle difference for CW vs CCW rotation">
            <div class="caption">Figure 5: DIR pulse sequence showing duty-cycle difference for clockwise vs anticlockwise rotation.</div>
          </div>
          
          A key outcome of this approach was that the pulse duty cycle became direction-dependent. Specifically, the pulse duty
          cycle during <b>anticlockwise</b> rotation was significantly smaller than during <b>clockwise</b> rotation, creating a clear and
          repeatable signature for direction classification. This duty-cycle difference provided a robust method to determine:
          <ul>
            <li><b>Direction (CW vs CCW)</b> from duty-cycle thresholding</li>
            <li><b>Speed (RPM)</b> from pulse period measurement</li>
          </ul>
          
          An additional advantage of this configuration was that both speed and direction information could be extracted using only
          the open-drain <b>DIR</b> output, eliminating the need to use a second output pin. This reduced wiring complexity and enabled
          a simpler interface to the microcontroller—requiring only a single digital input line to determine both RPM and direction state.
        </li>

        <li>
          <b>Firmware challenges and solutions</b><br><br>
        
        <ul class="subheading-list">
        
            <li>
              <i><b>Challenge:</b></i> RPM must be accurate across a wide speed range (very slow to very fast).<br>
              At low RPM, pulses are widely spaced, which reduces update rate and makes the speed estimate appear sluggish.
              At high RPM, pulse periods become very short, increasing susceptibility to timing jitter and interrupt overhead.<br>
              <i><b>Solution:</b></i> Implemented an interrupt-driven pulse period measurement approach using edge-to-edge timing.
              To improve stability, an adaptive averaging strategy was applied, where multiple pulse periods are averaged at higher
              speeds (for noise reduction), while fewer pulses are averaged at lower speeds (for responsiveness). A zero-speed timeout
              mechanism was also implemented to ensure the RPM output reliably drops to zero during stall or disengagement events.
            </li>
        
            <li>
              <i><b>Challenge:</b></i> Noise / false edges in a harsh industrial environment.<br>
              Electrical noise, long cable runs, mechanical vibration, and EMI from drill rig equipment can introduce false transitions,
              leading to incorrect RPM or unstable direction state detection.<br>
              <i><b>Solution:</b></i> Added edge qualification logic to reject unrealistically short pulse periods, combined with temporal
              filtering (moving average). Direction classification was implemented as a state-based decision process, requiring a consistent
              direction signature over multiple cycles before switching state, preventing flickering due to noise.
            </li>
        
            <li>
              <i><b>Challenge:</b></i> Direction detection must be reliable during start/stop and reversals.<br>
              During reversals and transient operation, pulse timing characteristics can become irregular, making direction classification
              unreliable if based on a single pulse or edge.<br>
              <i><b>Solution:</b></i> Direction was determined using a robust duty-cycle signature derived from multiple pulse cycles rather
              than instantaneous edge timing. Hysteresis and debouncing were applied by enforcing duty-cycle threshold margins and confirming
              direction changes over several consecutive cycles before updating the reported direction state.
            </li>
        
            <li>
              <i><b>Challenge:</b></i> “No pulse” and stall detection must not lag too much.<br>
              If the stall detection threshold is too long, the system continues reporting the last valid RPM after rotation stops.
              If it is too short, very low RPM operation may be incorrectly classified as zero.<br>
              <i><b>Solution:</b></i> Implemented a configurable timeout window tied to the minimum expected rotational speed, along with
              debounced zero detection to prevent oscillation between low-RPM readings and zero near the threshold.
            </li>
        </ul>
        
      </ul>
    </div>

    
  </div>

</body>
</html>
